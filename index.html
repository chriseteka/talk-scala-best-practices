<!DOCTYPE html>
<html>
  <head>
    <title>Scala Best Practices I Wish Someone'd Told Me About</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <link rel="stylesheet" type="text/css" href="css/style.css"/>
  </head>
  <body>
      <textarea id="source">
class: center, middle

# Scala Best Practices I Wish Someone'd Told Me About

Nicolas Rinaudo • [@NicolasRinaudo] • [Besedo]

---

## Overview

This is meant for Scala developers of beginner to intermediate levels.

The goal is to list common bad practices often seen in Scala code, and how to avoid them.

Each slide will start with a common pattern. See if you can work out what's wrong with it!

---

## Unicode operators

.section[Common implementation]

```scala
1 → 4 / 2
```

--

.section[Bad because] not actually equivalent to the ASCII operator


```scala
1 → 4 / 2
// <console>:13: error: value / is not a member of (Int, Int)
//        1 → 4 / 2
//              ^
```

---

## Unicode operators .super[2]

.section[Prefer] the ASCII operator

```scala
1 -> 4 / 2
// res2: (Int, Int) = (1,2)
```

--

.section[Future improvements]

Deprecated in [2.13](https://github.com/scala/scala/pull/7540)

---

## Enumerations

.section[Common implementation]

```scala
object Status extends Enumeration {
  val Ok, Nok = Value
}
```

--

.section[Bad because] no pattern match exhaustivity check

```scala
// No warning even though Status.Nok will crash this
def foo(w: Status.Value): Unit = w match {
  case Status.Ok => println("ok")
}
```

---

## Enumerations .super[2]

.section[Prefer] sealed trait hierarchies (ADTs)

```scala
sealed trait Status

object Status {
  case object Ok extends Status
  case object Nok extends Status
}
```

---

## Enumerations .super[3]

The compiler now knows we're not exhaustive:

```scala
def foo(w: Status): Unit = w match {
  case Status.Ok => println("ok")
}
// <console>:14: warning: match may not be exhaustive.
// It would fail on the following input: Nok
//        def foo(w: Status): Unit = w match {
//                                   ^
// foo: (w: Status)Unit
```

---

## Enumerations .super[4]

.section[Future improvements]

Dotty might eventually [deprecate](https://gitter.im/lampepfl/dotty?at=5ceaece6ecdf942b4c4de347) [`Enumeration`](https://www.scala-lang.org/api/current/scala/Enumeration.html) in favour of [enum](https://dotty.epfl.ch/docs/reference/enums/enums.html)

---

## Algebraic Data Types

.section[Common implementation]

```scala
sealed trait Status

object Status {
  case object Ok extends Status
  case object Nok extends Status
}
```

--

.section[Bad because] noisy type inference

```scala
List(Status.Ok, Status.Nok)
// res0: List[Product with Serializable with Status] = List(Ok, Nok)
```

---

## Algebraic Data Types .super[2]

.section[Prefer] having the root type extend [`Product`](https://www.scala-lang.org/api/current/scala/Product.html) and [`Serializable`](https://www.scala-lang.org/api/current/scala/Serializable.html)

```scala
sealed trait Status extends Product with Serializable

object Status {
  case object Ok extends Status
  case object Nok extends Status
}
```

--

The correct type is now inferred:

```scala
List(Status.Ok, Status.Nok)
// res1: List[Status] = List(Ok, Nok)
```

---

## Algebraic Data Types .super[3]

.section[Future improvements]

Dotty does a better job of hiding the issue, but [doesn't fix it](https://contributors.scala-lang.org/t/could-adts-extend-product-with-serializable-in-dotty/3304/59)

---

## Sealed traits

.section[Common implementation]

```scala
sealed trait Foo

class Bar extends Foo
```

--

.section[Bad because] the seal might leak

```scala
// In another file, compiles without a problem
class FooBar extends Bar
```

---

## Sealed traits .super[2]

.section[Prefer] `final` or `sealed` descendants

```scala
sealed trait Foo

final class Bar extends Foo
```

---

## Case classes

.section[Common implementation]

```scala
case class Foo(i: Int)
```

--

.section[Bad because] descendants don't behave as you'd expect

```scala
class Bar(i: Int, s: String) extends Foo(i)
```

```scala
new Bar(1, "foo") == new Bar(1, "bar")
// res0: Boolean = true
```

---

## Case classes .super[2]

.section[Prefer] final case classes

```scala
final case class Foo(i: Int)
```

---

## Custom extractors

.section[Common implementation]

```scala
object ExtractSome {
  def unapply[A](s: Some[A]): Option[A] = s
}
```

--

.section[Bad because] this compiles without a non-exhaustivity warning

```scala
def foo[A](o: Option[A]): A = o match {
  case ExtractSome(a) => a
}
```

---

## Custom extractors .super[2]

.section[Prefer] returning type [`Some`](https://www.scala-lang.org/api/current/scala/Some.html) for exhaustive extractors

```scala
object ExtractSome {
  def unapply[A](s: Some[A]): Some[A] = s
}
```

---

## Custom extractors .super[3]

We're now getting the expected warning:

```scala
def foo[A](o: Option[A]): A = o match {
  case ExtractSome(a) => a
}
// <console>:13: warning: match may not be exhaustive.
// It would fail on the following input: None
//        def foo[A](o: Option[A]): A = o match {
//                                      ^
// foo: [A](o: Option[A])A
```

--

Scala warns when it can find proof of non-exhaustivity, not when it can't find proof of exhaustivity.

Where is your god now?

---

## Custom extractors .super[4]

.section[Future improvements]

Dotty's exhaustivity checker is [much improved](https://infoscience.epfl.ch/record/225497/files/p61-liu.pdf), fixing most of these oddities

---

## Structural types

.section[Common implementation]

```scala
def add1(x: { def get: Int }): Int = 1 + x.get

final case class Wrapper(i: Int) {
  def get: Int = i
}
```

```scala
add1(Wrapper(1))
// res0: Int = 2
```

--

.section[Bad because]

* runtime cost
* availability on the JVM depends on runtime configuration (security managers)

---

## Structural types .super[2]

.section[Prefer] type classes

```scala
trait HasGet[A] {
  def get(a: A): Int
}

implicit val wrap: HasGet[Wrapper] = new HasGet[Wrapper] {
  def get(a: Wrapper) = a.i
}

def add1[A](a: A)(implicit hga: HasGet[A]): Int = hga.get(a) + 1
```

```scala
add1(Wrapper(1))
// res1: Int = 2
```

---

## Structural types .super[3]

.section[Future improvements]

Dotty's [structural types](https://dotty.epfl.ch/docs/reference/changed-features/structural-types.html) are far more flexible, but still default to reflection

---

class: center, middle

# Safety (type or otherwise)


---

## Type annotation

.section[Common implementation]

```scala
def asOpt[A](a: A) = Some(a)
```

--

.section[Bad because] the return type is not what you'd expect

```scala
def asOpt[A](a: A) = Some(a)
// asOpt: [A](a: A)Some[A]
```

---

## Type annotation .super[2]

.section[Prefer] explicitly type-annotated public methods

```scala
def asOpt[A](a: A): Option[A] = Some(a)
// asOpt: [A](a: A)Option[A]
```

---

## String concatenation

.section[Common implementation]

```scala
1 + "2"
// res0: String = 12
```

--

.section[Bad because] `+` often does not behave coherently

```scala
List("foo") + "bar"
// res1: String = List(foo)bar

Set("foo") + "bar"
// res2: scala.collection.immutable.Set[String] = Set(foo, bar)
```

---

## String concatenation .super[2]

Let's not even bring this abomination up:

```scala
List(1) + 2
// <console>:13: error: type mismatch;
//  found   : Int(2)
//  required: String
//        List(1) + 2
//                  ^
```

---
## String concatenation .super[3]

.section[Prefer]
* explicit calls to `toString`
* string interpolation

```scala
val foo = "FOO"
// foo: String = FOO

s"${foo}bar"
// res4: String = FOObar
```

---

## String concatenation .super[4]

.section[Future improvements]

* deprecated in [2.13](https://twitter.com/eed3si9n/status/1126960037086339072)
* removed from [2.14](https://twitter.com/eed3si9n/status/1126960825703514112)
* mysteriously fully supported in [Dotty](https://twitter.com/NicolasRinaudo/status/1126947756583661574)

???

Currently in a weird state:
- deprecated in 2.13
- removed from 2.14
- fully supported in Dotty

---

## Exceptions

.section[Common implementation]

```scala
def parseInt(str: String): Int = str.toInt
def elementAt[A](value: Array[A], i: Int): A = value(i)
```

--

.section[Bad because] where to begin...

* breaks referential transparency
* basically a `GOTO` statement
* unchecked (the compiler cannot enforce code validity)

---

## Exceptions .super[2]

.section[Prefer]

* [`Option`](http://www.scala-lang.org/api/2.12.2/scala/Option.html) to convey the potential absence of a value
* [`Either`](http://www.scala-lang.org/api/2.12.2/scala/util/Either.html) to convey a potentially failing computation
* [`Try`](http://www.scala-lang.org/api/2.12.2/scala/util/Try.html), if you have to deal with code that throws

---

## Errors

.section[Common implementation]

```scala
sealed trait DbError extends Product with Serializable

object DbError {
  case object InvalidSql extends DbError
  case object ConnectionLost extends DbError
}
```

--

.section[Bad because] existing APIs ([`Future`](https://www.scala-lang.org/api/current/scala/concurrent/Future.html), [`Try`](https://www.scala-lang.org/api/current/scala/util/Try.html)...) rely on [`Exception`](https://docs.oracle.com/javase/7/docs/api/java/lang/Exception.html) to convey errors

---

## Errors .super[2]

.section[Prefer] extending [`Exception`](https://docs.oracle.com/javase/7/docs/api/java/lang/Exception.html) (but no throwing!)

```scala
sealed trait DbError extends Exception with
  Product with Serializable

object DbError {
  case object InvalidSql extends DbError
  case object ConnectionLost extends DbError
}
```

---

## Errors .super[3]

We can now work with "clean" types:

```scala
// Turn an Either into a Try when needed
Left(DbError.InvalidSql).toTry

// Fail a Future with a useful error
scala.concurrent.Future.failed(DbError.InvalidSql)
```

???

I'm not a big fan of using `Exception` as a universal super type for errors, which is why I don't insist on it in
writing. Maybe worth bringing up, since Martin Odersky told me he though that was a desirable practice.

---

## The `return` keyword

.section["Common" implementation]

```scala
def add(n: Int, m: Int): Int = return n + m
```

--

.section[Bad because]

* breaks referential transparency
* basically a `GOTO` statement
* it doesn't do what you think it does

---

## The `return` keyword .super[2]

```scala
def foo(is: List[Int]): List[Int] =
  is.map(n => return n + 1)
// <console>:13: error: type mismatch;
//  found   : Int
//  required: List[Int]
//          is.map(n => return n + 1)
//                               ^
```

Doesn't seem to make sense, but let's change the type...

---

## The `return` keyword .super[3]

```scala
def foo(is: List[Int]): Int =
  is.map(n => return n + 1)
// <console>:13: error: type mismatch;
//  found   : List[Nothing]
//  required: Int
//          is.map(n => return n + 1)
//                ^
```

Fine, let's play along...

---

## The `return` keyword .super[4]

```scala
def foo(is: List[Int]): List[Nothing] =
  is.map(n => return n + 1)
// <console>:13: error: type mismatch;
//  found   : Int
//  required: List[Nothing]
//          is.map(n => return n + 1)
//                               ^
```

--

**(╯°□°）╯︵ ┻━┻**

---

## The `return` keyword .super[5]

.section[Prefer] never using `return`

---

## Recursion

.section[Common implementation]

```scala
def sum(is: List[Int]): Int = is match {
  case h :: t => h + sum(t)
  case _      => 0
}
```

--

.section[Bad because] stack unsafe

```scala
sum(List.range(1, 300000))
// java.lang.StackOverflowError
//   at .sum(<console>:12)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
```

---

## Recursion .super[2]

.section[Prefer] tail recursion

```scala
def sum(is: List[Int]): Int = {
  def loop(cur: List[Int], acc: Int): Int = cur match {
    case h :: t => loop(t, acc + h)
    case _      => acc
  }
  loop(is, 0)
}
```

--

Tail recursion is stack-safe:

```scala
sum(List.range(1, 300000))
// res1: Int = 2050177040
```

---

## Tail recursion

.section[Common implementation]

```scala
class Foo {
  def sum(cur: List[Int], acc: Int): Int = cur match {
    case h :: t => sum(t, acc + h)
    case _      => acc
  }
}
```

---

## Tail recursion .super[2]

.section[Bad because] this is not actually tail recursive

```scala
class Foo {
  @annotation.tailrec
  def sum(cur: List[Int], acc: Int): Int = cur match {
    case h :: t => sum(t, acc + h)
    case _      => acc
  }
}
// <console>:14: error: could not optimize @tailrec annotated method sum: it is neither private nor final so can be overridden
//          def sum(cur: List[Int], acc: Int): Int = cur match {
//              ^
```

---

## Tail recursion .super[3]

.section[Prefer] always annotating tail-recursive functions with [`@tailrec`](http://www.scala-lang.org/api/2.12.2/scala/annotation/tailrec.html)

---


## Implicit conversions

.section[Common implementation]

```scala
implicit def str2int(str: String): Int = Integer.parseInt(str)
```

--

.section[Bad because] we use types to prevent us from doing illegal operations

```scala
"foobar" / 2
// java.lang.NumberFormatException: For input string: "foobar"
//   at java.lang.NumberFormatException.forInputString(NumberFormatException.java:65)
//   at java.lang.Integer.parseInt(Integer.java:580)
//   at java.lang.Integer.parseInt(Integer.java:615)
//   at .str2int(<console>:12)
//   ... 43 elided
```

---

## Implicit conversions .super[2]

.section[Prefer] explicit conversions

```scala
scala.util.Try(Integer.parseInt("foobar")).map(_ / 2)
// res1: scala.util.Try[Int] = Failure(java.lang.NumberFormatException: For input string: "foobar")
```

Note: implicit conversions to enrich existing types (type class "syntax") are ok.

---

## Implicit conversions .super[3]

.section[Future improvements]

* Dotty locks this behind a [compilation flag](https://dotty.epfl.ch/docs/reference/contextual/conversions.html)
* [Extension methods](https://dotty.epfl.ch/docs/reference/contextual/extension-methods.html) have a separate mechanism in Dotty


---

## Implicit resolution

.section[Common implementation]

```scala
case class Config(port: Int)

object a1 {
  implicit val defaultConfig: Config = Config(8080)
}

def getPort(implicit c: Config): Int = c.port
```

```scala
{
  import a1._

  getPort
}
// res0: Int = 8080
```

---

## Implicit resolution .super[2]

.section[Bad because] identical names clash

```scala
object a2 {
  implicit val defaultConfig: Int = 12345
}
```

```scala
{
  import a1._, a2._

  getPort
}
// <console>:19: error: could not find implicit value for parameter c: Config
//          getPort
//          ^
```

???

The order of the imports is irrelevant.

---

## Implicit resolution .super[3]


.section[Prefer]
* very explicit names, including types
* unfortunately, no foolproof method I know of

--

.section[Future improvements]

[Fixed](http://dotty.epfl.ch/docs/reference/changed-features/implicit-resolution.html) in Dotty

---

## Checking for emptiness

.section[Common implementation]

```scala
def foo[A](s: Seq[A]): Unit =
  println(if(s.size == 0) "empty" else "non-empty")
```

--

.section[Bad because] not all collections are finite

```scala
// This doesn't return.
foo(Stream.from(1))
```

---

## Checking for emptiness .super[2]

.section[Prefer] `isEmpty` or `nonEmpty`

```scala
Stream.from(1).isEmpty
// res0: Boolean = false
```

---

## Array comparison

.section[Common implementation]

```scala
Array(1) == Array(1)
```

--

.section[Bad because] it does not work

```scala
Array(1) == Array(1)
// res1: Boolean = false
```

---

## Array comparison .super[2]

.section[Prefer] using `sameElements`

```scala
Array(1).sameElements(Array(1))
// res2: Boolean = true
```

---

## Array comparison .super[3]

.section[Future improvements]

2.13 introduces [immutable arrays](https://scala-lang.org/files/archive/api/2.13.x/scala/collection/immutable/ArraySeq.html) which behave as expected

Mutable arrays are still 🤪 though

---

## `Traversable` safety: `head`

.section[Common implementation]

```scala
Seq(1, 2, 3).head
// res0: Int = 1
```

--

.section[Bad because] some collections are empty

```scala
Seq.empty[Int].head
// java.util.NoSuchElementException: head of empty list
//   at scala.collection.immutable.Nil$.head(List.scala:430)
//   at scala.collection.immutable.Nil$.head(List.scala:427)
//   ... 43 elided
```

---

## `Traversable` safety: `head` .super[2]

.section[Prefer] `headOption`

```scala
Seq(1, 2, 3).headOption
// res2: Option[Int] = Some(1)

Seq.empty[Int].headOption
// res3: Option[Int] = None
```

---

## `Traversable` safety: `last`


.section[Common implementation]

```scala
Seq(1, 2, 3).last
// res0: Int = 3
```

--

.section[Bad because] some collections are empty

```scala
Seq.empty[Int].last
// java.util.NoSuchElementException
//   at scala.collection.LinearSeqOptimized.last(LinearSeqOptimized.scala:150)
//   at scala.collection.LinearSeqOptimized.last$(LinearSeqOptimized.scala:149)
//   at scala.collection.immutable.List.last(List.scala:89)
//   ... 43 elided
```

---

## `Traversable` safety: `last` .super[2]


.section[Prefer] `lastOption`

```scala
Seq(1, 2, 3).lastOption
// res2: Option[Int] = Some(3)

Seq.empty[Int].lastOption
// res3: Option[Int] = None
```
---

## `Traversable` safety: `tail`

.section[Common implementation]

```scala
Seq(1, 2, 3).tail
// res0: Seq[Int] = List(2, 3)
```

--

.section[Bad because] some collections are empty

```scala
Seq.empty[Int].tail
// java.lang.UnsupportedOperationException: tail of empty list
//   at scala.collection.immutable.Nil$.tail(List.scala:432)
//   at scala.collection.immutable.Nil$.tail(List.scala:427)
//   ... 43 elided
```

---

## `Traversable` safety: `tail` .super[2]

.section[Prefer] `drop(1)`

```scala
Seq(1, 2, 3).drop(1)
// res2: Seq[Int] = List(2, 3)

Seq.empty[Int].drop(1)
// res3: Seq[Int] = List()
```

---

## `Traversable` safety: `init`

.section[Common implementation]

```scala
Seq(1, 2, 3).init
// res0: Seq[Int] = List(1, 2)
```

--

.section[Bad because] some collections are empty

```scala
Seq.empty[Int].init
// java.lang.UnsupportedOperationException: empty.init
//   at scala.collection.TraversableLike.init(TraversableLike.scala:454)
//   at scala.collection.TraversableLike.init$(TraversableLike.scala:453)
//   at scala.collection.AbstractTraversable.init(Traversable.scala:108)
//   ... 43 elided
```

---

## `Traversable` safety: `init` .super[2]


.section[Prefer] `dropRight(1)`

```scala
Seq(1, 2, 3).dropRight(1)
// res2: Seq[Int] = List(1, 2)

Seq.empty[Int].dropRight(1)
// res3: Seq[Int] = List()
```

---

## `Traversable` safety: `reduce`


.section[Common implementation]

```scala
Seq(1, 2, 3).reduce(_ + _)
// res0: Int = 6
```

---

## `Traversable` safety: `reduce` .super[2]

.section[Bad because] some collections are empty

```scala
Seq.empty[Int].reduce(_ + _)
// java.lang.UnsupportedOperationException: empty.reduceLeft
//   at scala.collection.LinearSeqOptimized.reduceLeft(LinearSeqOptimized.scala:139)
//   at scala.collection.LinearSeqOptimized.reduceLeft$(LinearSeqOptimized.scala:138)
//   at scala.collection.immutable.List.reduceLeft(List.scala:89)
//   at scala.collection.TraversableOnce.reduce(TraversableOnce.scala:211)
//   at scala.collection.TraversableOnce.reduce$(TraversableOnce.scala:211)
//   at scala.collection.AbstractTraversable.reduce(Traversable.scala:108)
//   ... 43 elided
```

---

## `Traversable` safety: `reduce` .super[3]


.section[Prefer]

* `reduceOption`

```scala
Seq(1, 2, 3).reduceOption(_ + _)
// res2: Option[Int] = Some(6)

Seq.empty[Int].reduceOption(_ + _)
// res3: Option[Int] = None
```

* `fold`

```scala
Seq(1, 2, 3).fold(0)(_ + _)
// res4: Int = 6

Seq.empty[Int].fold(0)(_ + _)
// res5: Int = 0
```

---

class: center, middle

# Conclusions


---

## Enforcing best practices

* Code reviews
* Automated tools
  * [scapegoat](https://github.com/sksamuel/scapegoat)
  * [wartremover](http://www.wartremover.org)
  * [scala linter](https://github.com/HairyFotr/linter)
  * [scalastyle](http://www.scalastyle.org)
  * `scalac`, with sane options (see [Rob Norris' post on the subject](http://tpolecat.github.io/2017/04/25/scalac-flags.html))
  * [scalafix](https://github.com/scalacenter/scalafix)
---

## More good and bad practices

These were my favourite examples. I'm sure there are others.

I'd be happy to take suggestions for additions to this list, either now or after the talk!

---

## Special thanks

The [`scala/contributors`](https://gitter.im/scala/contributors) and [`lampepfl/dotty`](https://gitter.im/lampepfl/dotty) Gitter channels, and especially [Guillaume Martres](https://github.com/smarter).

They basically wrote the _Future improvements_ sections.

---


## More information

Slides available on https://nrinaudo.github.io/talk-scala-best-practices/

Articles on these are available on https://nrinaudo.github.io/scala-best-practices/

Find me on Twitter ([@NicolasRinaudo])

Get in touch with [Besedo], we're always on the lookout for Scala talent

Slides backed by [remark.js](https://remarkjs.com/) and the amazing [tut](https://github.com/tpolecat/tut)

---

class: center, middle

# Thanks!

[@NicolasRinaudo]:https://twitter.com/NicolasRinaudo
[Besedo]:https://twitter.com/besedo_official

    </textarea>
    <script src="js/remark.js" type="text/javascript">
    </script>
    <script type="text/javascript">
        var slideshow = remark.create({
        highlightStyle: 'solarized-dark'
      });
    </script>
  </body>
</html>

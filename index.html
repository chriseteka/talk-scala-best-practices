<!DOCTYPE html>
<html>
  <head>
    <title>Scala Best Practices I Wish Someone'd Told Me About</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <link rel="stylesheet" type="text/css" href="css/style.css"/>
  </head>
  <body>
      <textarea id="source">
class: center, middle

# Scala Best Practices I Wish Someone'd Told Me About

Nicolas Rinaudo • [`@NicolasRinaudo`](https://twitter.com/NicolasRinaudo) • [Besedo](http://besedo.com)

---

## Overview

This is meant for Scala developers of beginner to intermediate levels.

The goal is to list common bad practices often seen in Scala code, and how to avoid them.

Each slide will start with a common pattern. See if you can work out what's wrong with it!

---

class: center, middle

# Working with Numbers

---

## Checking for oddness

Common implementation :

```scala
3 % 2 == 1
// res0: Boolean = true
```

--

Bad because : fails on negative numbers

```scala
-3 % 2 == 1
// res1: Boolean = false
```

--

Prefer :

```scala
-3 % 2 != 0
// res2: Boolean = true
```

???

Checked by:

* scapegoat

---

## Checking for `NaN`

Common implementation :

```scala
2.0 == Double.NaN
// res0: Boolean = false
```

--

Bad because : it does not work

```scala
Double.NaN == Double.NaN
// res1: Boolean = false
```

--

Prefer : calling `isNaN`

```scala
Double.NaN.isNaN
// res2: Boolean = true

2.0.isNaN
// res3: Boolean = false
```

???

Checked by:

* linter
* scapegoat

Normal behaviour according to IEEE 754

---

## Float in ranges

Common implementation :

```scala
0.1 to 0.9 by 0.1
```

--

Bad because : floating points don't add nicely

```scala
(0.1 to 0.9 by 0.1).toList
// res1: List[Double] = List(0.1, 0.2, 0.30000000000000004, 0.4, 0.5, 0.6, 0.7, 0.7999999999999999, 0.8999999999999999)
```

--

Prefer : integral types in ranges

```scala
(1 to 9 by 1).map(_ / 10F).toList
// res2: List[Float] = List(0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9)
```

---

## Long literals

Common implementation :

```scala
val l = 32l
```

--

Bad because : depending on the font, `l` can't be hard to distinguish from `1`

```scala
List(1, 11, 111, 111l, 11111, 11111, 11111)
// res0: List[Long] = List(1, 11, 111, 111, 11111, 11111, 11111)
```

--

Prefer : upper-case L

```scala
List(1, 11, 111, 111L, 11111, 11111, 11111)
// res1: List[Long] = List(1, 11, 111, 111, 11111, 11111, 11111)
```

---

class: center, middle

# Data Representation

---

## Enumerations

Common implementation :

```scala
object Gender extends Enumeration {
  val Male, Female = Value
}
```

--

Bad because : no pattern match exhaustivity check

```scala
def foo(w: Gender.Value): Unit = w match {
  case Gender.Male ⇒ println("Male")
}
```

--

```scala
foo(Gender.Female)
// scala.MatchError: Female (of class scala.Enumeration$Val)
//   at .foo(<console>:14)
//   ... 444 elided
```

---

## Enumerations ²

Prefer : sealed trait hierarchies (ADTs)

```scala
sealed trait Gender
object Gender {
  case object Male extends Gender
  case object Female extends Gender
}
```

--

The compiler now knows we're not exhaustive:

```scala
def foo(w: Gender): Unit = w match {
  case Gender.Male ⇒ println("Male")
}
// <console>:14: warning: match may not be exhaustive.
// It would fail on the following input: Female
//        def foo(w: Gender): Unit = w match {
//                                   ^
// foo: (w: Gender)Unit
```


---

## Sealed traits

Common implementation :

```scala
sealed trait Foo

class Bar extends Foo
```

--

Bad because : the seal might leak

```scala
// In another file, compiles without a problem
class FooBar extends Bar
```

--

Prefer : `final` or `sealed` descendants

```scala
sealed trait Foo

final class Bar extends Foo
```

This applies even if `Bar` is a case class.


???

Checked by:

* scapegoat
* wartremover

---

## Algebraic Data Types

Common implementation :

```scala
sealed trait Gender
object Gender {
  case object Male extends Gender
  case object Female extends Gender
}
```

--

Bad because : noisy type inference

```scala
List(Gender.Male, Gender.Female)
// res0: List[Product with Serializable with Gender] = List(Male, Female)
```

---

## Algebraic Data Types ²

Prefer : having the root type extend `Product` and `Serializable`

```scala
sealed trait Gender extends Product with Serializable
object Gender {
  case object Male extends Gender
  case object Female extends Gender
}
```

--

The correct type is now inferred:

```scala
List(Gender.Male, Gender.Female)
// res1: List[Gender] = List(Male, Female)
```

---

## Case classes

Common implementation :

```scala
case class Foo(i: Int)
```

--

Bad because : descendants don't behave as you'd expect

```scala
class Bar(i: Int, s: String) extends Foo(i)
// defined class Bar

new Bar(1, "foo") == new Bar(1, "bar")
// res0: Boolean = true
```

--

Prefer : final case classes

```scala
final case class Foo(i: Int)
```

---

class: center, middle

# Safety (type or otherwise)


---

## Type annotation

Common implementation :

```scala
def asOpt[A](a: A) = Some(a)
```

--

Bad because : the return type is not what you'd expect

```scala
def asOpt[A](a: A) = Some(a)
// asOpt: [A](a: A)Some[A]
```

--

Prefer : explicitly type-annotated public methods

```scala
def asOpt[A](a: A): Option[A] = Some(a)
// asOpt: [A](a: A)Option[A]
```

---

## String concatenation

Common implementation :

```scala
1 + "2"
// res0: String = 12
```

--

Bad because : `+` often does not behave coherently

```scala
List("foo") + "bar"
// res1: String = List(foo)bar

Set("foo") + "bar"
// res2: scala.collection.immutable.Set[String] = Set(foo, bar)
```

???

Note that this would be perfectly valid with `Set`

--

Prefer :
* string interpolation
* compiler plugins that ban `any2stringadd`

---

## Exceptions

Common implementation :

```scala
def parseInt(str: String): Int = str.toInt
def elementAt[A](value: Array[A], i: Int): A = value(i)
```

--

Bad because : where to begin...

* basically a `GOTO` statement
* unchecked (the compiler cannot enforce code validity)

--

Prefer :

* [`Option`](http://www.scala-lang.org/api/2.12.2/scala/Option.html) to convey the potential absence of a value
* [`Either`](http://www.scala-lang.org/api/2.12.2/scala/util/Either.html) to convey a potentially failing computation
* [`Try`](http://www.scala-lang.org/api/2.12.2/scala/util/Try.html), if you have to deal with code that throws

---

## The `return` keyword

"Common" implementation :

```scala
def add(n: Int, m: Int): Int = return n + m
```

--

Bad because :

* basically a `GOTO` statement
* it doesn't do what you think it does

--

```scala
def foo(is: List[Int]): List[Int] = is.map(n ⇒ return n + 1)
// <console>:12: error: type mismatch;
//  found   : Int
//  required: List[Int]
//        def foo(is: List[Int]): List[Int] = is.map(n ⇒ return n + 1)
//                                                                ^
```

Doesn't seem to make sense, but let's change the type...

---

## The `return` keyword ²

```scala
def foo(is: List[Int]): Int = is.map(n ⇒ return n + 1)
// <console>:12: error: type mismatch;
//  found   : List[Nothing]
//  required: Int
//        def foo(is: List[Int]): Int = is.map(n ⇒ return n + 1)
//                                            ^
```

--

**ಠ_ಠ**

--

Prefer : never using `return`.


???

Also: not referentially transparent

See https://tpolecat.github.io/2014/05/09/return.html

---

## Implicit conversions

Common implementation :

```scala
implicit def str2int(str: String): Int = Integer.parseInt(str)
```

--

Bad because : we use types to prevent us from doing illegal operations

```scala
"foobar" / 2
// java.lang.NumberFormatException: For input string: "foobar"
//   at java.lang.NumberFormatException.forInputString(NumberFormatException.java:65)
//   at java.lang.Integer.parseInt(Integer.java:580)
//   at java.lang.Integer.parseInt(Integer.java:615)
//   at .str2int(<console>:12)
//   ... 1020 elided
```

---

## Implicit conversions ²

Prefer : explicit conversions

```scala
scala.util.Try(Integer.parseInt("foobar")).map(_ / 2)
// res1: scala.util.Try[Int] = Failure(java.lang.NumberFormatException: For input string: "foobar")
```

Note: implicit conversions to enrich existing types (type class "syntax") are ok.


---

## Implicit classes

Common usage / implementation: adding methods to existing types

```scala
object a1 {
  implicit class IntOps(s: String) {
    def add(i: Int): String = (s.toInt + i).toString
  }
}
```

```scala
{
  import a1._

  "123".add(1)
}
// res0: String = 124
```

---

## Implicit classes ²

Bad because : identical names clash

```scala
object a2 {
  implicit class IntOps(i: Int) {
    def isOdd: Boolean = i % 2 != 0
  }
}
```

```scala
{
  import a1._, a2._

  "123".add(1)
}
// <console>:18: error: value add is not a member of String
//          "123".add(1)
//                ^
```

--

Prefer :

* very explicit class names to avoid naming conflicts
* `ToXYZOps` pattern (see [Simulacrum](https://github.com/mpilquist/simulacrum) for an example)

???

Checked by: nothing that I know of.

---

## Java to / from Scala collections

Common implementation :

```scala
import collection.JavaConversions._

val it: Iterator[Int] = java.util.Arrays.asList(1, 2, 3).iterator()
```

--

Bad because :

* deprecated since 2.12.0
* relies on implicit conversion

--

Prefer : explicit conversion through [`JavaConverters`](http://www.scala-lang.org/api/2.12.2/scala/collection/JavaConverters$.html)

```scala
import collection.JavaConverters._
// import collection.JavaConverters._

val list = java.util.Arrays.asList(1, 2, 3).asScala
// list: scala.collection.mutable.Buffer[Int] = Buffer(1, 2, 3)
```
---

class: center, middle

# Collections


---

## Checking for emptiness

Common implementation :

```scala
def foo[A](s: Seq[A]): Unit =
  println(if(s.size == 0) "empty" else "non-empty")
```

--

Bad because : not all collections are finite

```scala
val haha: Seq[Int] = Stream.from(1)

// foo(haha) ?
```

--

Prefer : `isEmpty` or `nonEmpty`

```scala
Stream.from(1).isEmpty
// res2: Boolean = false
```

---

## Array comparison

Common implementation :

```scala
Array(1) == Array(1)
```

--

Bad because : it does not work

```scala
Array(1) == Array(1)
// res1: Boolean = false
```

--

Prefer : using `sameElements`

```scala
Array(1).sameElements(Array(1))
// res2: Boolean = true
```

???
Checked by:

* scapegoat


---

## `Traversable` safety: `head`

Common implementation :

```scala
Seq(1, 2, 3).head
// res0: Int = 1
```

--

Bad because : some collections are empty

```scala
Seq.empty[Int].head
// java.util.NoSuchElementException: head of empty list
//   at scala.collection.immutable.Nil$.head(List.scala:417)
//   at scala.collection.immutable.Nil$.head(List.scala:414)
//   ... 1022 elided
```

---

## `Traversable` safety: `head` ²

Prefer : `headOption`

```scala
Seq(1, 2, 3).headOption
// res2: Option[Int] = Some(1)

Seq.empty[Int].headOption
// res3: Option[Int] = None
```

---

## `Traversable` safety: `tail`

Common implementation :

```scala
Seq(1, 2, 3).tail
// res0: Seq[Int] = List(2, 3)
```

--

Bad because : some collections are empty

```scala
Seq.empty[Int].tail
// java.lang.UnsupportedOperationException: tail of empty list
//   at scala.collection.immutable.Nil$.tail(List.scala:419)
//   at scala.collection.immutable.Nil$.tail(List.scala:414)
//   ... 1022 elided
```

---

## `Traversable` safety: `tail` ²

Prefer : `drop(1)`

```scala
Seq(1, 2, 3).drop(1)
// res2: Seq[Int] = List(2, 3)

Seq.empty[Int].drop(1)
// res3: Seq[Int] = List()
```

---

## `Traversable` safety: `init`

Common implementation :

```scala
Seq(1, 2, 3).init
// res0: Seq[Int] = List(1, 2)
```

--

Bad because : some collections are empty

```scala
Seq.empty[Int].init
// java.lang.UnsupportedOperationException: empty.init
//   at scala.collection.TraversableLike.init(TraversableLike.scala:451)
//   at scala.collection.TraversableLike.init$(TraversableLike.scala:450)
//   at scala.collection.AbstractTraversable.init(Traversable.scala:104)
//   ... 1021 elided
```

---

## `Traversable` safety: `init` ²


Prefer : `dropRight(1)`

```scala
Seq(1, 2, 3).dropRight(1)
// res2: Seq[Int] = List(1, 2)

Seq.empty[Int].dropRight(1)
// res3: Seq[Int] = List()
```

---

## `Traversable` safety: `last`


Common implementation :

```scala
Seq(1, 2, 3).last
// res0: Int = 3
```

--

Bad because : some collections are empty

```scala
Seq.empty[Int].last
// java.util.NoSuchElementException
//   at scala.collection.LinearSeqOptimized.last(LinearSeqOptimized.scala:146)
//   at scala.collection.LinearSeqOptimized.last$(LinearSeqOptimized.scala:145)
//   at scala.collection.immutable.List.last(List.scala:86)
//   ... 1021 elided
```

---

## `Traversable` safety: `last` ²


Prefer : `lastOption`

```scala
Seq(1, 2, 3).lastOption
// res2: Option[Int] = Some(3)

Seq.empty[Int].lastOption
// res3: Option[Int] = None
```
---

## `Traversable` safety: `reduce`


Common implementation :

```scala
Seq(1, 2, 3).reduce(_ + _)
// res0: Int = 6
```

--

Bad because : some collections are empty

```scala
Seq.empty[Int].reduce(_ + _)
// java.lang.UnsupportedOperationException: empty.reduceLeft
//   at scala.collection.LinearSeqOptimized.reduceLeft(LinearSeqOptimized.scala:135)
//   at scala.collection.LinearSeqOptimized.reduceLeft$(LinearSeqOptimized.scala:134)
//   at scala.collection.immutable.List.reduceLeft(List.scala:86)
//   at scala.collection.TraversableOnce.reduce(TraversableOnce.scala:208)
//   at scala.collection.TraversableOnce.reduce$(TraversableOnce.scala:208)
//   at scala.collection.AbstractTraversable.reduce(Traversable.scala:104)
//   ... 1018 elided
```

---

## `Traversable` safety: `reduce` ²


Prefer :

* `reduceOption`

```scala
Seq(1, 2, 3).reduceOption(_ + _)
// res2: Option[Int] = Some(6)

Seq.empty[Int].reduceOption(_ + _)
// res3: Option[Int] = None
```

* `fold`

```scala
Seq(1, 2, 3).fold(0)(_ + _)
// res4: Int = 6

Seq.empty[Int].fold(0)(_ + _)
// res5: Int = 0
```

---

class: center, middle

# Miscellaneous


---

## Recursion

Common implementation :

```scala
def sum(is: List[Int]): Int = is match {
  case h :: t ⇒ h + sum(t)
  case _      ⇒ 0
}
```

--

Bad because : stack unsafe

```scala
sum(List.range(1, 30000))
// java.lang.StackOverflowError
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
//   at .sum(<console>:13)
```

---

## Recursion ²

Prefer : tail recursion

```scala
def sum(is: List[Int]): Int = {
  def loop(cur: List[Int], acc: Int): Int = cur match {
    case h :: t ⇒ loop(t, acc + h)
    case _      ⇒ acc
  }
  loop(is, 0)
}
```

--

Tail recursion is stack-safe:

```scala
sum(List.range(1, 30000))
// res1: Int = 449985000
```

---

## Tail recursion

Common implementation :

```scala
class Foo {
  def sum(cur: List[Int], acc: Int): Int = cur match {
    case h :: t ⇒ sum(t, acc + h)
    case _      ⇒ acc
  }
}
```

---

## Tail recursion ²

Bad because : this is not actually tail recursive

```scala
class Foo {
  @annotation.tailrec
  def sum(cur: List[Int], acc: Int): Int = cur match {
    case h :: t ⇒ sum(t, acc + h)
    case _      ⇒ acc
  }
}
// <console>:14: error: could not optimize @tailrec annotated method sum: it is neither private nor final so can be overridden
//          def sum(cur: List[Int], acc: Int): Int = cur match {
//              ^
```

--

Prefer : always annotating tail-recursive functions with [`@tailrec`](http://www.scala-lang.org/api/2.12.2/scala/annotation/tailrec.html)


---

## Structural types

Common implementation :

```scala
def add1(x: { def get: Int }): Int = 1 + x.get

case class Wrapper(i: Int) {
  def get: Int = i
}
```

```scala
add1(Wrapper(1))
// res1: Int = 2
```

--

Bad because :

* runtime cost
* not available on all platforms (although it _is_ supported by [scala.js](https://www.scala-js.org)
  and [scala native](https://github.com/scala-native/scala-native))

???

Reference: https://twitter.com/den_sh/status/854261433038761984

---

## Structural types ²

Prefer : type classes

```scala
trait HasGet[A] {
  def get(a: A): Int
}

implicit val wrap: HasGet[Wrapper] = new HasGet[Wrapper] {
  def get(a: Wrapper) = a.i
}

def add1[A](a: A)(implicit hga: HasGet[A]): Int = hga.get(a) + 1
```

```scala
add1(Wrapper(1))
// res4: Int = 2
```

---

class: center, middle

# Conclusions


---

## Enforcing best practices

* Code reviews
* Automated tools
  * [scapegoat](https://github.com/sksamuel/scapegoat)
  * [wartremover](http://www.wartremover.org)
  * [scala linter](https://github.com/HairyFotr/linter)
  * [abide](https://github.com/scala/scala-abide)
  * [scalastyle](http://www.scalastyle.org)
  * `scalac`, with sane options (see [Rob Norris' post on the subject](http://tpolecat.github.io/2014/04/11/scalac-flags.html))
---

## More good and bad practices

These were my favourite examples. I'm sure there are others.

I'd be happy to take suggestions for additions to this list, either now or after the talk!

---


## More information

Slides available on https://nrinaudo.github.io/talk-scala-best-practices/

Find me on Twitter ([`@NicolasRinaudo`](https://twitter.com/NicolasRinaudo))

Get in touch with [`Besedo`](https://twitter.com/besedo_official), we're always on the lookout for Scala talent

Slides backed by [remark.js](https://remarkjs.com/) and [Rob Norris](https://twitter.com/tpolecat)' amazing
[tut](https://github.com/tpolecat/tut)

---

class: center, middle

# Thanks!

    </textarea>
    <script src="js/remark.js" type="text/javascript">
    </script>
    <script type="text/javascript">
        var slideshow = remark.create({
        highlightStyle: 'solarized-dark'
      });
    </script>
  </body>
</html>
